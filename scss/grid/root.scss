@use "variables";
@use "../system";
@use "sass:map";

$smallest-breakpoint: null;

@each $breakpoint, $min-width in variables.$breakpoints {
  @if $min-width == 0 {
    $smallest-breakpoint: $breakpoint;
  }
}

@each $breakpoint, $min-width in variables.$breakpoints {
  $breakpoint-map: $breakpoint;

  @if $breakpoint == $smallest-breakpoint {
    $breakpoint-map: false;
  }

  $size-unit: false;
  @if $breakpoint == print {
    $size-unit: in;
  }

  @include system.add-root-style(
                  #{variables.$variable-prefix}breakpoint-#{$breakpoint},
                  system.size-unit($min-width, $size-unit)
  );

  $container: map.get(variables.$containers, $breakpoint);

  $container-max-width: map.get($container, max-width);
  @if not $container-max-width {
    $container-max-width: unset;
  }

  @include system.add-root-style(
                  #{variables.$variable-prefix}container-max-width,
                  system.size-unit($container-max-width, $size-unit),
                  $breakpoint-map
  );

  $container-padding: map.get($container, padding);
  @if not $container-padding {
    $container-padding: unset;
  }

  @include system.add-root-style(
                  #{variables.$variable-prefix}container-padding,
                  system.size-unit($container-padding, $size-unit),
                  $breakpoint-map
  );

  $gutter: map.get(variables.$gutter, $breakpoint);
  @if not $gutter {
    $gutter: (
            columns: 1,
    );
  }

  $columns: map.get(variables.$columns, $breakpoint);

  $gap: map.get($gutter, gap);
  $row-gap: unset;
  $column-gap: unset;
  @if $gap {
    $row-gap: $gap;
    $column-gap: $gap;
  } @else {
    @if map.has-key($gutter, row-gap) {
      $row-gap: map.get($gutter, row-gap);
    }
    @if map.has-key($gutter, column-gap) {
      $column-gap: map.get($gutter, column-gap);
    }
  }

  @include system.add-root-style(
                  #{variables.$variable-prefix}gutter-columns,
                  $columns,
                  $breakpoint-map
  );
  @include system.add-root-style(
                  #{variables.$variable-prefix}gutter-row-gap,
                  system.size-unit($row-gap, $size-unit),
                  $breakpoint-map
  );

  @include system.add-root-style(
                  #{variables.$variable-prefix}gutter-column-gap,
                  system.size-unit($column-gap, $size-unit),
                  $breakpoint-map
  );
}